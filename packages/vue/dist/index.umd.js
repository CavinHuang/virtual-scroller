(function(p,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(p=typeof globalThis<"u"?globalThis:p||self,e(p.Virtual={},p.Vue))})(this,function(p,e){"use strict";const k=/scroll|auto|overlay/i,S=window||void 0;function w(t){return t.tagName!=="HTML"&&t.tagName!=="BODY"&&t.nodeType===1}function x(t,l=S){let o=t;for(;o&&o!==l&&w(o);){const{overflowY:r}=window.getComputedStyle(o);if(k.test(r))return o;o=o.parentNode}return l}function P(t,l=S){const o=e.ref();return e.onMounted(()=>{t.value&&(o.value=x(t.value,l))}),o}function H(t,l){return t>l?"horizontal":l>t?"vertical":""}function N(){const t=e.ref(0),l=e.ref(0),o=e.ref(0),r=e.ref(0),h=e.ref(0),f=e.ref(0),c=e.ref(""),i=()=>c.value==="vertical",m=()=>c.value==="horizontal",d=()=>{o.value=0,r.value=0,h.value=0,f.value=0,c.value=""};return{move:a=>{const _=a.touches[0];o.value=(_.clientX<0?0:_.clientX)-t.value,r.value=_.clientY-l.value,h.value=Math.abs(o.value),f.value=Math.abs(r.value);const E=10;(!c.value||h.value<E&&f.value<E)&&(c.value=H(h.value,f.value))},start:a=>{d(),t.value=a.touches[0].clientX,l.value=a.touches[0].clientY},reset:d,startX:t,startY:l,deltaX:o,deltaY:r,offsetX:h,offsetY:f,direction:c,isVertical:i,isHorizontal:m}}function M(t){const l="scrollTop"in t?t.scrollTop:t.pageYOffset;return Math.max(l,0)}const V=t=>t.stopPropagation();function Y(t,l){(typeof t.cancelable!="boolean"||t.cancelable)&&t.preventDefault(),l&&V(t)}function b(t){let l;e.onMounted(()=>{t(),e.nextTick(()=>{l=!0})}),e.onActivated(()=>{l&&t()})}function B(t,l,o={}){if(!window)return;const{target:r=window,passive:h=!1,capture:f=!1}=o;let c=!1,i;const m=s=>{if(c)return;const a=e.unref(s);a&&!i&&(a.addEventListener(t,l,{capture:f,passive:h}),i=!0)},d=s=>{if(c)return;const a=e.unref(s);a&&i&&(a.removeEventListener(t,l,f),i=!1)};e.onUnmounted(()=>d(r)),e.onDeactivated(()=>d(r)),b(()=>m(r));let g;return e.isRef(r)&&(g=e.watch(r,(s,a)=>{d(a),m(s)})),()=>{g==null||g(),d(r),c=!0}}const L={key:0,class:"pull-refresh_text"},O={key:1,class:"loading"},C=e.defineComponent({__name:"PullRefresh",props:{disabled:{type:Boolean},modelValue:{type:Boolean},headHeight:{default:50},successText:null,pullingText:null,loosingText:null,loadingText:null,pullDistance:null,successDuration:{default:500},animationDuration:{default:300}},emits:["change","refresh","update:modelValue"],setup(t,{emit:l}){const o=t,r=50,h=["pulling","loosing","success"],f={normal:"",loading:"",success:"",pulling:"下拉即可刷新...",loosing:"释放即可刷新..."},c=e.useSlots();let i;const m=e.ref(),d=e.ref(),g=P(m),s=e.reactive({status:"normal",distance:0,duration:0}),a=N(),_=e.computed(()=>({transitionDuration:`${s.duration}ms`,transform:s.distance?`translate3d(0,${s.distance}px, 0)`:""})),E=()=>{if(o.headHeight!==r)return{height:`${o.headHeight}px`}},D=()=>s.status!=="loading"&&s.status!=="success"&&!o.disabled,R=n=>{const u=+(o.pullDistance||o.headHeight);return n>u&&(n<u*2?n=u+(n-u)/2:n=u*1.5+(n-u*2)/4),Math.round(n)},T=(n,u)=>{const I=+(o.pullDistance||o.headHeight);s.distance=n,u?s.status="loading":n===0?s.status="normal":n<I?s.status="pulling":s.status="loosing",l("change",{status:s.status,distance:n})},X=()=>{const{status:n}=s;return n==="normal"?"":o[`${n}Text`]||f[n]},A=()=>{s.status="success",setTimeout(()=>{T(0)},+o.successDuration)},y=n=>{i=M(g.value)===0,i&&(s.duration=0,a.start(n))},$=n=>{D()&&y(n)},z=n=>{if(D()){i||y(n);const{deltaY:u}=a;a.move(n),i&&u.value>=0&&a.isVertical()&&(Y(n),T(R(u.value)))}},v=()=>{i&&a.deltaY.value&&D()&&(s.duration=+o.animationDuration,s.status==="loosing"?(T(+o.headHeight,!0),l("update:modelValue",!0),e.nextTick(()=>l("refresh"))):T(0))};return e.watch(()=>o.modelValue,n=>{s.duration=+o.animationDuration,n?T(+o.headHeight,!0):c.success||o.successText?A():T(0,!1)}),B("touchmove",z,{target:d}),(n,u)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"root",ref:m,class:"pull-refresh"},[e.createElementVNode("div",{ref_key:"track",ref:d,class:"pull-refresh__track",style:e.normalizeStyle(e.unref(_)),"on:touchstartPassive":$,onTouchend:v,onTouchcancel:v},[e.createElementVNode("div",{class:"pull-refresh__head",style:e.normalizeStyle(E())},[e.renderSlot(n.$slots,s.status,{},()=>[h.includes(s.status)?(e.openBlock(),e.createElementBlock("div",L,e.toDisplayString(X()),1)):e.createCommentVNode("",!0),s.status==="loading"?(e.openBlock(),e.createElementBlock("div",O)):e.createCommentVNode("",!0)])],4),e.renderSlot(n.$slots,"default")],36)],512))}}),U="";p.PullRefresh=C,Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})});
